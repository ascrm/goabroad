# å…¨å±€å¯¼èˆªæ é‡æ„è¯´æ˜

## ğŸ“‹ é‡æ„èƒŒæ™¯

### é—®é¢˜æè¿°
ä¹‹å‰çš„å®ç°æ–¹å¼ä¸­ï¼Œè™½ç„¶å‘½åä¸º"å…¨å±€é¡¶éƒ¨å¯¼èˆªæ "ï¼Œä½†å®é™…ä¸Šæ¯ä¸ª Tab é¡µé¢éƒ½éœ€è¦å•ç‹¬ç¼–å†™ä¸€æ¬¡ `TopNavigationBar` ç»„ä»¶ï¼Œå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

1. **ä»£ç é‡å¤**ï¼š5ä¸ªé¡µé¢é‡å¤å†™äº†5æ¬¡å¯¼èˆªæ ä»£ç 
2. **ç»´æŠ¤å›°éš¾**ï¼šä¿®æ”¹å¯¼èˆªæ éœ€è¦åœ¨å¤šä¸ªæ–‡ä»¶ä¸­åŒæ­¥ä¿®æ”¹
3. **æ ·å¼ä¸ä¸€è‡´**ï¼šå„é¡µé¢çš„å¯¼èˆªæ é…ç½®å’Œæ ·å¼å¯èƒ½ä¸ä¸€è‡´
4. **ä¸æ˜¯çœŸæ­£çš„"å…¨å±€"**ï¼šæ¯ä¸ªé¡µé¢éƒ½æ˜¯å•ç‹¬å®ä¾‹åŒ–ï¼Œä¸èƒ½ç»Ÿä¸€ç®¡ç†

## âœ… é‡æ„æ–¹æ¡ˆ

é‡‡ç”¨**æ–¹æ¡ˆä¸€**ï¼šåœ¨ `_layout.jsx` ä¸­ç»Ÿä¸€ç®¡ç†å…¨å±€å¯¼èˆªæ ï¼Œå®ç°çœŸæ­£çš„å…¨å±€åŒ–ã€‚

### æ ¸å¿ƒæ€è·¯

1. å°† `TopNavigationBar` æå‡åˆ° `app/(tabs)/_layout.jsx` ä¸­
2. ä½¿ç”¨ `usePathname()` åŠ¨æ€æ£€æµ‹å½“å‰è·¯ç”±
3. æ ¹æ®è·¯ç”±è¿”å›ä¸åŒçš„å¯¼èˆªæ é…ç½®ï¼ˆä¸­é—´å†…å®¹ã€å³ä¾§æŒ‰é’®ç­‰ï¼‰
4. ä»å„ä¸ª Tab é¡µé¢ä¸­ç§»é™¤é‡å¤çš„ `TopNavigationBar` ä»£ç 

## ğŸ“ ä¿®æ”¹æ–‡ä»¶æ¸…å•

### 1. `app/(tabs)/_layout.jsx` - æ ¸å¿ƒä¿®æ”¹

**æ–°å¢å¯¼å…¥**ï¼š
```javascript
import { Tabs, usePathname, useRouter } from 'expo-router';
import { StatusBar } from 'expo-status-bar';
import { SafeAreaView } from 'react-native-safe-area-context';
import { DrawerGestureWrapper, DrawerMenu, TopNavigationBar } from '@/src/components/layout';
import { useAuth } from '@/src/store/hooks';
```

**æ–°å¢å‡½æ•° `getNavBarConfig()`**ï¼š
æ ¹æ®å½“å‰è·¯å¾„ `pathname` è¿”å›å¯¼èˆªæ é…ç½®ï¼š

```javascript
const getNavBarConfig = () => {
  // create-plan é¡µé¢ä¸æ˜¾ç¤ºå¯¼èˆªæ ï¼ˆå› ä¸ºä¼šç«‹å³è·³è½¬ï¼‰
  if (pathname === '/create-plan') {
    return { show: false };
  }

  // é»˜è®¤é…ç½®
  const config = {
    show: true,
    centerContent: null,
    rightContent: null,
  };

  // æ ¹æ®è·¯å¾„å®šåˆ¶å¯¼èˆªæ 
  switch (pathname) {
    case '/':
    case '/index':
      // é¦–é¡µï¼šå³ä¾§æ˜¾ç¤ºé€šçŸ¥æŒ‰é’®
      config.rightContent = <é€šçŸ¥æŒ‰é’®>;
      break;

    case '/community':
      // ç¤¾åŒºé¡µï¼šä¸­é—´æ˜¾ç¤ºæ ‡é¢˜ï¼Œå³ä¾§æ˜¾ç¤ºæœç´¢æŒ‰é’®
      config.centerContent = <Text>ç¤¾åŒº</Text>;
      config.rightContent = <æœç´¢æŒ‰é’®>;
      break;

    case '/countries':
      // å›½å®¶é¡µï¼šä¸­é—´æ˜¾ç¤ºæ ‡é¢˜
      config.centerContent = <Text>ç•™å­¦å›½å®¶</Text>;
      break;

    case '/my-plans':
      // è§„åˆ’é¡µï¼šä¸­é—´æ˜¾ç¤ºæ ‡é¢˜ï¼Œå³ä¾§æ˜¾ç¤ºåˆ›å»ºæŒ‰é’®
      config.centerContent = <Text>æˆ‘çš„è§„åˆ’</Text>;
      config.rightContent = <åˆ›å»ºæŒ‰é’®>;
      break;

    default:
      break;
  }

  return config;
};
```

**å¸ƒå±€ç»“æ„**ï¼š
```jsx
<DrawerContext.Provider value={{ openDrawer, closeDrawer }}>
  <SafeAreaView style={styles.safeArea} edges={['top']}>
    <StatusBar style="dark" />
    
    <DrawerGestureWrapper onSwipeOpen={openDrawer}>
      {/* å…¨å±€é¡¶éƒ¨å¯¼èˆªæ  */}
      {navBarConfig.show && (
        <TopNavigationBar
          userInfo={userInfo}
          onAvatarPress={openDrawer}
          centerContent={navBarConfig.centerContent}
          rightContent={navBarConfig.rightContent}
        />
      )}

      {/* Tabs å†…å®¹ */}
      <View style={styles.tabsContainer}>
        <Tabs>
          {/* Tab é…ç½® */}
        </Tabs>
      </View>
    </DrawerGestureWrapper>
    
    {/* å…¨å±€æŠ½å±‰èœå• */}
    <DrawerMenu visible={drawerVisible} onClose={closeDrawer} />
  </SafeAreaView>
</DrawerContext.Provider>
```

### 2. `app/(tabs)/index.jsx` - é¦–é¡µ

**ç§»é™¤å†…å®¹**ï¼š
- `import { DrawerGestureWrapper, TopNavigationBar }` - ä¸å†éœ€è¦
- `import { useDrawer }` - ä¸å†éœ€è¦
- `import { useAuth }` - ä¸å†éœ€è¦
- æ•´ä¸ª `<TopNavigationBar>` ç»„ä»¶åŠå…¶é…ç½®
- é€šçŸ¥æŒ‰é’®ç›¸å…³ä»£ç å’Œæ ·å¼
- `<DrawerGestureWrapper>` åŒ…è£¹å±‚

**ç®€åŒ–åçš„ç»“æ„**ï¼š
```jsx
export default function Home() {
  const [refreshing, setRefreshing] = useState(false);
  
  return (
    <View style={styles.container}>
      <ScrollView>
        {/* é¡µé¢å†…å®¹ */}
      </ScrollView>
    </View>
  );
}
```

### 3. `app/(tabs)/community.jsx` - ç¤¾åŒºé¡µ

**ç§»é™¤å†…å®¹**ï¼š
- `import { DrawerGestureWrapper, TopNavigationBar }` - ä¸å†éœ€è¦
- `import { useDrawer }` - ä¸å†éœ€è¦
- `import { useAuth }` - ä¸å†éœ€è¦
- `import { SafeAreaView }` - ä¸å†éœ€è¦
- `import { StatusBar }` - ä¸å†éœ€è¦
- æ•´ä¸ª `<TopNavigationBar>` ç»„ä»¶åŠå…¶é…ç½®
- é¡µé¢æ ‡é¢˜å’Œæœç´¢æŒ‰é’®ï¼ˆå·²ç§»åˆ°å…¨å±€å¯¼èˆªæ ï¼‰
- `<DrawerGestureWrapper>` å’Œ `<SafeAreaView>` åŒ…è£¹å±‚

**ç®€åŒ–åçš„ç»“æ„**ï¼š
```jsx
export default function Community() {
  return (
    <View style={styles.container}>
      {/* Tab æ  */}
      <View style={styles.tabBar}>...</View>
      
      {/* Feed æµ */}
      <FeedList tab={activeTab} />
      
      {/* æ‚¬æµ®å‘å¸ƒæŒ‰é’® */}
      <View style={styles.fabContainer}>...</View>
    </View>
  );
}
```

### 4. `app/(tabs)/countries.jsx` - å›½å®¶é¡µ

**ç§»é™¤å†…å®¹**ï¼š
- `import { DrawerGestureWrapper, TopNavigationBar }` - ä¸å†éœ€è¦
- `import { useDrawer }` - ä¸å†éœ€è¦
- `import { useAuth }` - ä¸å†éœ€è¦
- `import { SafeAreaView }` - ä¸å†éœ€è¦
- æ•´ä¸ª `<TopNavigationBar>` ç»„ä»¶
- `<DrawerGestureWrapper>` å’Œ `<SafeAreaView>` åŒ…è£¹å±‚

**ç‰¹æ®Šå¤„ç†**ï¼š
ç”±äºå›½å®¶é¡µçš„å¯¼èˆªæ é…ç½®æ¯”è¾ƒç‰¹æ®Šï¼ˆåŒ…å«æœç´¢æ¡†å’Œå¤šä¸ªåŠŸèƒ½æŒ‰é’®ï¼‰ï¼Œå°†æœç´¢æ ç§»åˆ°é¡µé¢å†…å®¹é¡¶éƒ¨ï¼š

```jsx
export default function CountriesPage() {
  return (
    <View style={styles.container}>
      {/* æœç´¢æ å’ŒåŠŸèƒ½æŒ‰é’® */}
      <View style={styles.searchBar}>
        <View style={styles.searchContainer}>
          <Ionicons name="search" size={20} />
          <TextInput placeholder="æœç´¢å›½å®¶..." />
        </View>
        
        <View style={styles.headerActions}>
          {/* è§†å›¾åˆ‡æ¢ã€å¯¹æ¯”æ¨¡å¼ã€é«˜çº§ç­›é€‰æŒ‰é’® */}
        </View>
      </View>
      
      {/* ç­›é€‰ Tab */}
      <CountryFilters />
      
      {/* å›½å®¶åˆ—è¡¨ */}
      {/* ... */}
    </View>
  );
}
```

### 5. `app/(tabs)/my-plans.jsx` - æˆ‘çš„è§„åˆ’

**ç§»é™¤å†…å®¹**ï¼š
- `import { DrawerGestureWrapper, TopNavigationBar }` - ä¸å†éœ€è¦
- `import { useDrawer }` - ä¸å†éœ€è¦
- `import { useAuth }` - ä¸å†éœ€è¦
- `import { StatusBar }` - ä¸å†éœ€è¦
- æ•´ä¸ª `<TopNavigationBar>` ç»„ä»¶åŠå…¶é…ç½®
- é¡µé¢æ ‡é¢˜å’Œåˆ›å»ºæŒ‰é’®ï¼ˆå·²ç§»åˆ°å…¨å±€å¯¼èˆªæ ï¼‰
- `<DrawerGestureWrapper>` åŒ…è£¹å±‚

**ç®€åŒ–åçš„ç»“æ„**ï¼š
```jsx
export default function MyPlans() {
  return (
    <View style={styles.container}>
      {/* è§†å›¾åˆ‡æ¢å™¨ */}
      <ViewSwitcher currentView={currentView} onViewChange={setCurrentView} />
      
      {/* å½“å‰è§†å›¾å†…å®¹ */}
      {renderCurrentView()}
    </View>
  );
}
```

## ğŸ¯ é‡æ„æˆæœ

### âœ… ä¼˜ç‚¹

1. **çœŸæ­£çš„å…¨å±€ç®¡ç†**ï¼šå¯¼èˆªæ åªåœ¨ `_layout.jsx` ä¸­å®šä¹‰ä¸€æ¬¡
2. **ç»Ÿä¸€çš„ç”¨æˆ·ä½“éªŒ**ï¼šæ‰€æœ‰é¡µé¢çš„å¯¼èˆªæ é«˜åº¦ã€æ ·å¼ã€äº¤äº’å®Œå…¨ä¸€è‡´
3. **æ˜“äºç»´æŠ¤**ï¼šä¿®æ”¹å¯¼èˆªæ åªéœ€è¦åœ¨ä¸€ä¸ªåœ°æ–¹ä¿®æ”¹
4. **ä»£ç ç²¾ç®€**ï¼šåˆ é™¤äº†å¤§é‡é‡å¤ä»£ç 
5. **çµæ´»é…ç½®**ï¼šé€šè¿‡ `getNavBarConfig()` å¯ä»¥è½»æ¾ä¸ºä¸åŒé¡µé¢å®šåˆ¶å¯¼èˆªæ 

### ğŸ“Š ä»£ç ç»Ÿè®¡

| æ–‡ä»¶ | åˆ é™¤è¡Œæ•° | ç®€åŒ–ç¨‹åº¦ |
|------|---------|---------|
| `_layout.jsx` | +150è¡Œ | æ–°å¢å…¨å±€ç®¡ç†é€»è¾‘ |
| `index.jsx` | -70è¡Œ | 40% |
| `community.jsx` | -55è¡Œ | 35% |
| `countries.jsx` | -60è¡Œï¼ˆéƒ¨åˆ†ç§»åˆ°é¡µé¢å†…ï¼‰ | 30% |
| `my-plans.jsx` | -45è¡Œ | 25% |
| **æ€»è®¡** | **å‡€å‡å°‘çº¦80è¡Œ** | - |

## ğŸ”§ æ‰©å±•æ€§

### å¦‚ä½•ä¸ºæ–°é¡µé¢æ·»åŠ å¯¼èˆªæ é…ç½®

åœ¨ `_layout.jsx` çš„ `getNavBarConfig()` å‡½æ•°ä¸­æ·»åŠ æ–°çš„ caseï¼š

```javascript
case '/new-page':
  config.centerContent = <Text>æ–°é¡µé¢</Text>;
  config.rightContent = <CustomButton />;
  break;
```

### å¦‚ä½•éšè—æŸä¸ªé¡µé¢çš„å¯¼èˆªæ 

```javascript
if (pathname === '/fullscreen-page') {
  return { show: false };
}
```

### å¦‚ä½•æ·»åŠ å…¨å±€é€šçŸ¥è§’æ ‡

åœ¨ `_layout.jsx` ä¸­ç»Ÿä¸€ç®¡ç†é€šçŸ¥è§’æ ‡çŠ¶æ€ï¼Œå¹¶åœ¨é€šçŸ¥æŒ‰é’®ä¸Šæ˜¾ç¤ºã€‚

## ğŸ“Œ æ³¨æ„äº‹é¡¹

1. **è·¯å¾„åŒ¹é…**ï¼šç¡®ä¿ `pathname` çš„åˆ¤æ–­ä¸å®é™…è·¯ç”±è·¯å¾„ä¸€è‡´
2. **create-plan é¡µé¢**ï¼šè¯¥é¡µé¢ä¼šç«‹å³è·³è½¬ï¼Œå› æ­¤ä¸æ˜¾ç¤ºå¯¼èˆªæ 
3. **å›½å®¶é¡µæœç´¢æ **ï¼šç”±äºé…ç½®å¤æ‚ï¼Œæœç´¢æ ç§»åˆ°äº†é¡µé¢å†…å®¹ä¸­ï¼Œä¿æŒåŠŸèƒ½å®Œæ•´æ€§

## ğŸ‰ æ€»ç»“

è¿™æ¬¡é‡æ„å½»åº•è§£å†³äº†"å‡å…¨å±€"å¯¼èˆªæ çš„é—®é¢˜ï¼Œå®ç°äº†çœŸæ­£çš„å…¨å±€ç»Ÿä¸€ç®¡ç†ã€‚ä»£ç æ›´ç®€æ´ã€æ›´æ˜“ç»´æŠ¤ï¼Œç”¨æˆ·ä½“éªŒæ›´ä¸€è‡´ã€‚è¿™æ˜¯ä¸€æ¬¡æˆåŠŸçš„æ¶æ„ä¼˜åŒ–ï¼

---

**é‡æ„æ—¥æœŸ**ï¼š2025-10-26  
**é‡æ„è€…**ï¼šAI Assistant + User

