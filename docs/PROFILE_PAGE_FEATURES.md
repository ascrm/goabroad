# 📱 个人中心页面功能说明

本文档详细说明个人中心（Profile）页面的所有功能按钮及其对应的操作。

---

## 📑 目录

1. [页面概览](#页面概览)
2. [用户信息区域](#用户信息区域)
3. [统计数据区域](#统计数据区域)
4. [功能列表区域](#功能列表区域)
5. [工具和服务区域](#工具和服务区域)
6. [设置和其他区域](#设置和其他区域)
7. [退出登录](#退出登录)
8. [API 集成说明](#api-集成说明)

---

## 页面概览

个人中心页面是用户管理个人信息、查看统计数据、访问各种功能的主要入口。页面分为以下几个区域：

- **用户信息区域**：显示头像、昵称、个性签名、等级等
- **会员卡片**：显示会员状态和有效期
- **统计数据**：显示发帖数、收藏数、获赞数等（会员显示）
- **功能列表**：快速访问常用功能
- **工具和服务**：访问实用工具
- **设置和其他**：账号设置、帮助、关于等

---

## 用户信息区域

### 1. 头像按钮 👤

**触发方式**：点击用户头像

**功能说明**：
- 弹出选项菜单
- 提供两种选择：
  - 📷 **从相册选择**：从手机相册选择图片作为头像
  - 📸 **拍照**：打开相机拍照作为头像

**API 调用**：
```javascript
// 使用的 Hook
const { uploadAvatar } = useUser();

// API 方法
uploadAvatar(file)
```

**API 端点**：`POST /users/avatar`

**操作流程**：
1. 用户点击头像
2. 弹出选项菜单（从相册选择 / 拍照）
3. 选择或拍摄图片
4. 系统自动裁剪为 1:1 比例
5. 压缩图片质量到 80%
6. 调用 `uploadAvatar` API 上传
7. 上传成功后更新本地头像显示
8. 显示"头像更新成功"提示

**权限要求**：
- 📷 相册选择：需要相册访问权限
- 📸 拍照：需要相机访问权限

**状态指示**：
- 上传中显示加载动画
- 成功显示提示信息
- 失败显示错误提示

---

### 2. 编辑资料按钮 ✏️

**触发方式**：点击右上角的"编辑"按钮

**功能说明**：
- 跳转到编辑资料页面
- 可以修改：昵称、个性签名、目标国家、留学类型等

**路由跳转**：`/profile/edit`

**操作流程**：
1. 用户点击"编辑"按钮
2. 跳转到编辑资料页面
3. 用户修改资料
4. 点击保存
5. 调用 `updateProfile` API
6. 返回个人中心，显示更新后的信息

---

### 3. 昵称和签名

**显示内容**：
- **昵称**：用户设置的显示名称
- **个性签名**：用户的个人简介或座右铭
- **等级**：Lv.X（根据经验值计算）
- **经验条**：当前经验值进度

**数据来源**：
```javascript
// 从 API 获取
const { profile } = useUser();

// 显示字段
profile.nickname    // 昵称
profile.bio         // 个性签名
profile.level       // 等级
profile.experience  // 经验值
```

---

## 统计数据区域

### 4. 统计数据卡片 📊

**显示内容**（仅会员可见）：

| 统计项 | 说明 | 数据来源 |
|--------|------|----------|
| **规划进度** | 留学规划完成百分比 | `stats.planProgress` |
| **发帖数** | 用户发布的帖子总数 | `stats.postsCount` |
| **收藏数** | 用户收藏的内容总数 | `stats.favoritesCount` |
| **获赞数** | 用户获得的点赞总数 | `stats.likesCount` |

**API 调用**：
```javascript
// 用户资料中包含统计数据
const { stats } = useUser();

// API 端点: GET /users/profile
// 返回数据包含 stats 字段
```

**触发时机**：
- 页面加载时自动获取
- 下拉刷新时更新
- 从其他页面返回时自动刷新

---

## 功能列表区域

### 5. 我的计划 🚩

**触发方式**：点击"我的计划"菜单项

**功能说明**：
- 查看和管理留学规划
- 包括时间线、待办事项、进度追踪等

**路由跳转**：`/profile/my-plans`

**图标**：🚩 旗帜图标（蓝色背景）

---

### 6. 我的发布 📝

**触发方式**：点击"我的发布"菜单项

**功能说明**：
- 查看用户发布的所有内容
- 包括帖子、问题、动态等

**路由跳转**：`/profile/my-posts`

**API 调用**：
```javascript
// 使用的 Hook
const { posts, getUserPosts } = useUser();

// API 方法
getUserPosts(userId, page, pageSize, type)
```

**API 端点**：`GET /users/:userId/posts`

**图标**：📝 文档图标（蓝色背景）

---

### 7. 我的收藏 ⭐

**触发方式**：点击"我的收藏"菜单项

**功能说明**：
- 查看收藏的所有内容
- 可以按类型筛选（帖子、问题、资源等）

**路由跳转**：`/profile/my-favorites`

**API 调用**：
```javascript
// 使用的 Hook
const { favorites, getUserFavorites } = useUser();

// API 方法
getUserFavorites(page, pageSize)
```

**API 端点**：`GET /users/favorites`

**图标**：⭐ 星星图标（黄色背景）

---

### 8. 我的评论 💬

**触发方式**：点击"我的评论"菜单项

**功能说明**：
- 查看用户发表的所有评论
- 可以快速跳转到对应的帖子

**路由跳转**：`/profile/my-comments`

**图标**：💬 对话框图标（绿色背景）

---

### 9. 我的文件 📁

**触发方式**：点击"我的文件"菜单项

**功能说明**：
- 查看上传的所有文件
- 包括文档、图片、PDF 等

**路由跳转**：`/profile/my-files`

**图标**：📁 文件夹图标（红色背景）

---

## 工具和服务区域

### 10. 工具箱 🔧

**触发方式**：点击"工具箱"菜单项

**功能说明**：
- 访问各种实用工具
- 如货币转换、时差计算、签证查询等

**路由跳转**：`/tools`

**图标**：🔧 工具图标（蓝色背景）

---

### 11. 服务 💼

**触发方式**：点击"服务"菜单项

**功能说明**：
- 查看付费服务
- **当前状态**：已禁用（显示"v2.0"标签）
- 计划在 v2.0 版本推出

**图标**：💼 公文包图标（灰色背景）

---

## 设置和其他区域

### 12. 通知设置 🔔

**触发方式**：点击"通知设置"菜单项

**功能说明**：
- 管理推送通知偏好
- 设置通知类型和频率

**路由跳转**：`/profile/notifications`

**API 调用**：
```javascript
// 使用的 Hook
const { preferences, updatePreferences } = useUserPreferences();

// API 方法
updatePreferences({ notifications: {...} })
```

**图标**：🔔 铃铛图标（黄色背景）

---

### 13. 语言切换 🌐

**触发方式**：点击"语言切换"菜单项

**功能说明**：
- 切换应用语言
- **当前语言**：简体中文
- **可选语言**：英语、繁体中文、日语等（开发中）

**当前状态**：功能开发中

**图标**：🌐 地球图标（蓝色背景）

---

### 14. 设置 ⚙️

**触发方式**：点击"设置"菜单项

**功能说明**：
- 访问所有设置选项
- 包括账号、隐私、安全等

**路由跳转**：`/profile/settings`

**图标**：⚙️ 齿轮图标（灰色背景）

---

### 15. 反馈建议 💭

**触发方式**：点击"反馈建议"菜单项

**功能说明**：
- 向开发团队提交反馈
- 报告 bug 或提出改进建议

**当前状态**：功能开发中

**图标**：💭 对话气泡图标（绿色背景）

---

### 16. 帮助中心 ❓

**触发方式**：点击"帮助中心"菜单项

**功能说明**：
- 查看常见问题
- 学习如何使用应用

**当前状态**：功能开发中

**图标**：❓ 问号图标（蓝色背景）

---

### 17. 关于我们 ℹ️

**触发方式**：点击"关于我们"菜单项

**功能说明**：
- 显示应用信息
- 版本号、开发团队、联系方式等

**当前版本**：v1.0.0

**弹窗内容**：
```
关于我们
GoAbroad v1.0.0
一站式留学规划平台
```

**图标**：ℹ️ 信息图标（灰色背景）

---

## 退出登录

### 18. 退出登录按钮 🚪

**触发方式**：点击底部的"退出登录"按钮

**功能说明**：
- 退出当前账号
- 清除本地登录状态
- 跳转到登录页面

**API 调用**：
```javascript
// 使用的 Thunk
const dispatch = useDispatch();
await dispatch(logoutUser()).unwrap();
```

**API 端点**：`POST /auth/logout`

**操作流程**：
1. 用户点击"退出登录"
2. 弹出确认对话框
   - **取消**：关闭对话框
   - **退出**：继续退出流程
3. 调用退出登录 API
4. 清除本地 Token 和用户数据
5. 跳转到登录页面 `/(auth)/login`

**安全说明**：
- 即使 API 调用失败，也会清除本地状态
- 确保用户能够在任何情况下退出登录

---

## API 集成说明

### 使用的 API Hook

```javascript
import { useUser } from '@/src/hooks/useUser';

const {
  // 状态
  profile,           // 用户资料
  stats,             // 统计数据
  loading,           // 加载状态
  error,             // 错误信息
  
  // 方法
  uploadAvatar,      // 上传头像
  refreshProfile,    // 刷新资料
  getUserPosts,      // 获取用户帖子
  getUserFavorites,  // 获取收藏列表
  updateProfile,     // 更新资料
} = useUser();
```

### 页面加载时的 API 调用

1. **初始化加载**
   ```javascript
   useEffect(() => {
     const initializeProfile = async () => {
       const result = await refreshProfile();
       // 更新 Redux 状态
     };
     initializeProfile();
   }, []);
   ```

2. **数据同步**
   - API 数据 → Redux 状态
   - 保持 UI 和后端数据一致

### 错误处理

所有 API 调用都包含错误处理：

```javascript
try {
  const result = await apiMethod();
  if (result.payload) {
    // 成功处理
  } else {
    throw new Error(result.error?.message);
  }
} catch (error) {
  Alert.alert('错误', error.message);
}
```

### 加载状态

- **首次加载**：显示全屏加载动画
- **上传头像**：显示按钮加载状态
- **刷新数据**：显示下拉刷新动画

---

## 开发环境 Mock 数据

在开发环境中，如果 API 调用失败，会自动回退到 Mock 数据：

```javascript
if (__DEV__ && !userInfo.id) {
  // 使用 Mock 数据
  initializeMockProfileData(dispatch, {
    setUserInfo,
    setMembership,
    updateStats,
    // ...
  });
}
```

这确保了开发过程中即使没有后端服务也能正常开发和测试。

---

## 按钮功能总结表

| 序号 | 按钮名称 | 触发方式 | API 调用 | 路由跳转 | 状态 |
|------|----------|----------|----------|----------|------|
| 1 | 头像按钮 | 点击头像 | `POST /users/avatar` | - | ✅ 已实现 |
| 2 | 编辑资料 | 点击"编辑" | - | `/profile/edit` | ✅ 已实现 |
| 3 | 会员升级 | 点击会员卡片 | - | - | 🚧 开发中 |
| 4 | 我的计划 | 点击菜单项 | - | `/profile/my-plans` | ✅ 已实现 |
| 5 | 我的发布 | 点击菜单项 | `GET /users/:id/posts` | `/profile/my-posts` | ✅ 已实现 |
| 6 | 我的收藏 | 点击菜单项 | `GET /users/favorites` | `/profile/my-favorites` | ✅ 已实现 |
| 7 | 我的评论 | 点击菜单项 | - | `/profile/my-comments` | ✅ 已实现 |
| 8 | 我的文件 | 点击菜单项 | - | `/profile/my-files` | ✅ 已实现 |
| 9 | 工具箱 | 点击菜单项 | - | `/tools` | ✅ 已实现 |
| 10 | 服务 | 点击菜单项 | - | - | 🔒 已禁用 (v2.0) |
| 11 | 通知设置 | 点击菜单项 | `PUT /users/preferences` | `/profile/notifications` | ✅ 已实现 |
| 12 | 语言切换 | 点击菜单项 | - | - | 🚧 开发中 |
| 13 | 设置 | 点击菜单项 | - | `/profile/settings` | ✅ 已实现 |
| 14 | 反馈建议 | 点击菜单项 | - | - | 🚧 开发中 |
| 15 | 帮助中心 | 点击菜单项 | - | - | 🚧 开发中 |
| 16 | 关于我们 | 点击菜单项 | - | - | ✅ 已实现 |
| 17 | 退出登录 | 点击底部按钮 | `POST /auth/logout` | `/(auth)/login` | ✅ 已实现 |

**图例**：
- ✅ 已实现：功能完整可用
- 🚧 开发中：功能规划中或部分实现
- 🔒 已禁用：暂不可用，计划未来版本推出

---

## 相关文档

- [用户 API 使用指南](./USER_API_GUIDE.md)
- [GoAbroad API 接口文档](./GoAbroad%20API%20接口文档.md)
- [编辑资料页面说明](./EDIT_PROFILE_GUIDE.md)

---

## 更新日志

### v1.0.0 (2024-10-25)

- ✅ 集成用户 API
- ✅ 实现头像上传功能
- ✅ 实现资料加载和刷新
- ✅ 添加错误处理和加载状态
- ✅ 支持开发环境 Mock 数据

---

如有问题或建议，请联系开发团队。

